<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>明日方舟六星幹員潛能記錄器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #111827; /* Tailwind: bg-gray-900 */
            color: #d1d5db; /* Tailwind: text-gray-300 */
        }

        .class-header {
            display: flex;
            align-items: center;
            gap: 1rem; /* Tailwind: gap-4 */
            font-size: 1.5rem; /* Tailwind: text-2xl */
            line-height: 2rem;
            font-weight: 700; /* Tailwind: font-bold */
            color: #818cf8; /* Tailwind: text-indigo-400 */
            margin-top: 2rem; /* Tailwind: mt-8 */
            margin-bottom: 1rem; /* Tailwind: mb-4 */
            border-bottom: 2px solid #374151; /* Tailwind: border-b-2 border-gray-700 */
            padding-bottom: 0.5rem; /* Tailwind: pb-2 */
        }

        .class-icon {
            width: 2rem; /* Tailwind: w-8 */
            height: 2rem; /* Tailwind: h-8 */
        }

        .operator-grid {
            display: flex;
            flex-wrap: nowrap; /* 確保不換行，強制橫向 */
            gap: 1rem; /* Tailwind: gap-4 */
            overflow-x: auto; /* 啟用水平滾動條 */
            padding-bottom: 0.75rem; /* Tailwind: pb-3 (為滾動條留出空間) */
        }

        .operator-card {
            position: relative;
            flex-shrink: 0; /* 防止卡片在 flex 容器中被壓縮 */
            width: 5rem; /* Tailwind: w-20 */
            height: 5rem; /* Tailwind: h-20 */
            border-radius: 0.5rem; /* Tailwind: rounded-lg */
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); /* Tailwind: shadow-lg */
            cursor: pointer;
            transition: transform 0.2s ease-in-out, filter 0.2s ease-in-out;
        }

        .operator-card:hover {
            transform: scale(1.05);
            z-index: 10;
        }
        
        @media (min-width: 768px) {
            .operator-card {
                width: 6rem; /* Tailwind: md:w-24 */
                height: 6rem; /* Tailwind: md:h-24 */
            }
        }

        .operator-avatar {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: filter 0.2s ease-in-out;
        }
        
        /* 未持有時的灰階樣式 */
        .is-not-owned .operator-avatar {
            filter: grayscale(1);
        }

        .potential-overlay {
            position: absolute;
            bottom: 0;
            right: 0;
            padding: 0.125rem 0.5rem; /* Tailwind: px-2 py-0.5 */
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            font-weight: 700; /* Tailwind: font-bold */
            font-size: 0.875rem; /* Tailwind: text-sm */
            line-height: 1.25rem;
            border-top-left-radius: 0.5rem; /* Tailwind: rounded-tl-lg */
            pointer-events: none;
        }
        
        .is-max-potential .potential-overlay {
            background-color: rgba(0, 0, 0, 0.75);
            color: #facc15; /* Tailwind: text-yellow-400 (金色) */
            font-weight: 700;
        }

        .operator-grid::-webkit-scrollbar {
            height: 8px;
        }
        .operator-grid::-webkit-scrollbar-track {
            background: #1f2937; /* Tailwind: bg-gray-800 */
            border-radius: 4px;
        }
        .operator-grid::-webkit-scrollbar-thumb {
            background: #4f46e5; /* Tailwind: bg-indigo-600 */
            border-radius: 4px;
        }
        .operator-grid::-webkit-scrollbar-thumb:hover {
            background: #6366f1; /* Tailwind: bg-indigo-500 */
        }
    </style>
</head>
<body>

    <div id="app" class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">明日方舟六星幹員潛能記錄器</h1>
            <p class="text-gray-400">點擊頭像即可更新幹員潛能。</p>
        </header>

        <div id="stats-container" class="text-center mb-8 p-4 bg-gray-800 rounded-lg shadow-md flex justify-center gap-8">
            <div>
                <p class="text-gray-400 text-sm">持有率</p>
                <p id="stats-ownership" class="text-2xl font-bold text-white">-</p>
            </div>
            <div>
                <p class="text-gray-400 text-sm">總潛能數</p>
                <p id="stats-total-potential" class="text-2xl font-bold text-white">-</p>
            </div>
        </div>
        
        <main id="operators-container" class="space-y-6">
            <!-- Operator class sections will be inserted here -->
        </main>
        
        <footer class="text-center mt-12 text-gray-500 text-sm">
            <p>資料將自動儲存於您的瀏覽器。</p>
        </footer>
    </div>

    <script type="module">
        const operatorClasses = {
            '先鋒': ['推進之王', '風笛', '嵯峨', '琴柳', '焰尾', '伺夜', '伊內絲', '繆爾賽思', '忍冬'],
            '近衛': ['銀灰', '斯卡蒂', '陳', '赫拉格', '煌', '棘刺', '史爾特爾', '山', '帕拉斯', '耀騎士臨光', '艾麗妮', '百煉嘉維爾', '瑪恩納', '重岳', '仇白', '聖約送葬人', '赫德雷', '止頌', '薇薇安娜', '鐧', '左樂', '烏爾比安', '佩佩', '維娜.維多利亞', '隱德來希'],
            '重裝': ['星熊', '塞雷婭', '年', '森蚺', '瑕光', '泥岩', '號角', '斥罪', '滌火潔西卡', '黍', '余', '信仰攪拌機'],
            '狙擊': ['能天使', '黑', 'W', '早露', '迷迭香', '空弦', 'Ash', '假日威龍陳', '遠牙', '菲亞梅塔', '鴻雪', '提豐', '萊伊', '維什戴爾', '娜仁圖亞', '蕾繆安'],
            '術師': ['伊芙利特', '艾雅法拉', '莫斯提馬', '刻俄柏', '夕', '異客', '卡涅利安', '澄閃', '黑鍵', '林', '霍爾海雅', '邏各斯', '妮芙', '瑪露西爾', '荒蕪拉普蘭德', '燭煌', '死芒'],
            '醫療': ['閃靈', '夜鶯', '凱爾希', '流明', '焰影葦草', '純燼艾雅法拉', 'Mon3tr'],
            '輔助': ['安潔莉娜', '麥哲倫', '鈴蘭', '濁心斯卡蒂', '靈知', '令', '白鐵', '淬羽赫默', '塑心', '魔王', '酒神'],
            '特種': ['阿', '傀影', '溫蒂', '歌蕾蒂婭', '水月', '老鯉', '歸溟幽靈鯊', '多蘿西', '緘默德克薩斯', '麒麟R夜刀', '琳瑯詩懷雅', 'Ela', '阿斯卡綸', '弒君者', '引星棘刺', '新約能天使']
        };

        let potentialsData = {};
        const operatorsContainer = document.getElementById('operators-container');
        const LOCAL_STORAGE_KEY = 'arknightsPotentialsData';

        function loadPotentialsFromLocal() {
            try {
                const savedData = localStorage.getItem(LOCAL_STORAGE_KEY);
                potentialsData = savedData ? JSON.parse(savedData) : {};
            } catch (e) {
                console.error("讀取本地資料失敗:", e);
                potentialsData = {};
            }
        }

        function savePotentialsToLocal() {
            try {
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(potentialsData));
            } catch (e) {
                console.error("儲存本地資料失敗:", e);
            }
        }

        function renderOperators() {
            operatorsContainer.innerHTML = '';
            const classOrder = ['先鋒', '近衛', '重裝', '狙擊', '術師', '醫療', '輔助', '特種'];

            classOrder.forEach(className => {
                const operatorsInClass = operatorClasses[className];
                if (!operatorsInClass || operatorsInClass.length === 0) return;
                
                const classSection = document.createElement('section');
                const classHeader = document.createElement('h2');
                classHeader.className = 'class-header';
                classHeader.innerHTML = `<img src="./images/classes/${className}.png" class="class-icon" alt="${className} icon" onerror="this.style.display='none'"><span>${className}</span>`;
                classSection.appendChild(classHeader);

                const operatorGrid = document.createElement('div');
                operatorGrid.className = 'operator-grid';

                operatorsInClass.forEach(name => {
                    // 初始潛能預設為 0 (未持有)
                    const potential = potentialsData[name] || 0;
                    const card = createOperatorCard(name, potential);
                    operatorGrid.appendChild(card);
                });

                classSection.appendChild(operatorGrid);
                operatorsContainer.appendChild(classSection);
            });
        }

        function createOperatorCard(name, potential) {
            const card = document.createElement('div');
            card.className = 'operator-card';
            card.dataset.operator = name;
            card.title = name; 

            const avatarUrl = `./images/avatars/${name}.png`;
            const avatarEl = document.createElement('img');
            avatarEl.src = avatarUrl;
            avatarEl.alt = name;
            avatarEl.className = 'operator-avatar';
            avatarEl.loading = 'lazy'; 
            avatarEl.onerror = function() {
                this.onerror=null;
                this.parentElement.innerHTML += `<div class="w-full h-full bg-gray-700 flex items-center justify-center text-xs text-center p-1">${name}<br>(圖檔遺失)</div>`;
                this.remove();
            };

            const potentialOverlay = document.createElement('span');
            potentialOverlay.className = 'potential-overlay';
            
            function updateCardState(p) {
                potentialOverlay.textContent = `P${p}`;
                // 根據潛能值切換樣式
                card.classList.toggle('is-not-owned', p === 0);
                card.classList.toggle('is-max-potential', p === 6);
            }

            updateCardState(potential);
            
            card.addEventListener('click', () => {
                // 循環邏輯為 0-6
                let currentPotential = potentialsData[name] || 0;
                const newPotential = (currentPotential + 1) % 7; // 循環 0 -> 1 -> ... -> 6 -> 0
                updatePotential(name, newPotential);
            });
            
            card.appendChild(avatarEl);
            card.appendChild(potentialOverlay);
            
            card.updateDisplay = (newPotential) => {
                 updateCardState(newPotential);
            };

            return card;
        }

        function updatePotential(name, newPotential) {
            // 若潛能為0，則從資料中刪除，代表未持有
            if (newPotential === 0) {
                delete potentialsData[name];
            } else {
                potentialsData[name] = newPotential;
            }

            const card = document.querySelector(`[data-operator="${name}"]`);
            if (card && card.updateDisplay) {
                card.updateDisplay(newPotential);
            }
            savePotentialsToLocal();
            updateStats();
        }
        
        function updateStats() {
            const statsOwnershipEl = document.getElementById('stats-ownership');
            const statsTotalPotentialEl = document.getElementById('stats-total-potential');

            const totalOperators = Object.values(operatorClasses).flat().length;
            const ownedOperators = Object.keys(potentialsData).length;
            const totalPotential = Object.values(potentialsData).reduce((sum, p) => sum + p, 0);

            const ownershipRate = totalOperators > 0 ? (ownedOperators / totalOperators) * 100 : 0;

            statsOwnershipEl.textContent = `${ownershipRate.toFixed(1)}% (${ownedOperators}/${totalOperators})`;
            statsTotalPotentialEl.textContent = totalPotential;
        }

        function initializeApp() {
            loadPotentialsFromLocal();
            renderOperators();
            updateStats();
        }

        initializeApp();
    </script>
</body>
</html>
